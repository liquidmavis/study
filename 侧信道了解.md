





# **密码**

**每个安全系统的安全性都取决于它最脆弱的部分**

## **Kerckhoff原则**

加密方案的安全性仅仅依赖于对密钥的保密，而不依赖于对算法的保密



## **分组密码**

概念：加密固定长度的数据分组的加密算法



### DES

仅仅有56位密钥长度和64位分组长度

DES算法有64位明文，首先对明文进行**IP置换**，然后把明文一分为二 L和R，然后进行16次加密算法

下图虚线框表示**轮函数**，32位R通过扩展变为48位，然后与轮秘钥K进行异或（不进位的加法），S盒再把48位非线性映射为32位，再与L异或得到L，将次L与R交换，继续进行加密运算



![1602640580648](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1602640580648.png)



总的结构采用了Feistel（Feistel 密码结构是用于[分组密码](https://baike.baidu.com/item/分组密码/1436163)中的一种对称结构。以它的发明者 Horst Feistel 。Feistel 的优点在于：由于它是对称的密码结构，所以**对信息的加密和解密的过程就极为相似**，甚至完全一样。这就使得在实施的过程中，对编码量和线路传输的要求就减少了几乎一半。）

![总流程](https://img-blog.csdnimg.cn/20190218174302211.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zNzEyMzA2OA==,size_16,color_FFFFFF,t_70)

### AES

没有采用Feistel

AES输入128位明文，明文与128位轮密码进行异或，然后进入8位输入8位输出的S盒，输出后按特定顺序组合分成4组，再使用线性混合函数异或运算，**一般AES要进行10-14轮加密，轮数取决于密钥长度，对应128、192、256位**

下面为一轮AES加密

![1602675635187](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1602675635187.png)



## 分组密码工作模式

概念：为了处理明文长度不恰好为一个分组长度的数据

### 填充

对明文进行填充来满足分组长度

（1）计算需要填充的字节数n，然后在明文后附加n个字节，每个字节填充的值为n

### CBC（密码分组链）

应用最广泛的分组密码工作模式

通过将每个分组与前一个密文分组异或。避免了明文相同密文就相同的问题

![1602676804243](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1602676804243.png)

CBC有一个问题在于如何选择初始向量(IV)也就是P0

1. 固定IV：会造成第一个明文相同密文就相同的问题
2. 计数器IV：会造成第一个明文相同密文就相同的问题
3. 随机IV：密文会比明文多发一条，对于消息短的数据来说会增加消耗
4. **瞬时IV：系统分配一个唯一值，对消息进行编号，分组密码加密瞬时值得到IV，用IV来加密信息**

## 散列函数

### 需要满足的要求

- 是单向函数，给定消息m，求h(m)容易，想倒退m不可能
- 抗碰撞性（适合数字签名）

### MD5

由Ron Rivest设计的一个128位散列函数。基于MD4

原理：将消息分为512位分组，对最后一个分组填充。MD5有128位的状态变量，被分为4个32位得字。压缩函数H'进行4轮，每轮消息分组和状态变量进行混合，4轮完后，将结果与状态变量相加输出。



### SHA

SHA1也是基于MD4，SHA1也是进行4轮压缩，但因为其利用线性递归而使得消息每个位至少进行了12轮运算，但其劣势是输出只有160位，容易被破解



SHA-224、SHA-256、SHA-384、SHA-512指的是输出的长度

## 消息认证码(MAC)

为了防止加密的消息被篡改，而是用了MAC



### CBC-MAC

计算过程（要求IV固定0 ）  **不推荐使用该算法**

![1602768293906](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1602768293906.png)

容易被攻击，被他人用篡改的信息通过MAC认证

如要使用该算法应该：

1. 对L||M构造串S，L是消息m在固定长度格式下的编码长度
2. 对S进行填充满足分组长度整数倍
3. 对填充后的S应用算法
4. 输出最后一个密文分组或一部分，不要输出中间值

### HMAC

使用散列函数来实现MAC,结构清晰，便捷高效，非常流行

HMAC（K，M）=H（（K’⊕opad）∣H（（K’⊕ipad）∣M））  （opad和ipad为常数）

推荐使用SHA-256为散列函数的HMAC



## 生成随机性

### 生成器

解释：负责将固定长度状态转换为任意长度输出。这里用AES分组密码作为生成器，内部状态包括了一个256位的分组密码密钥和128位计数器。

每次请求完后需要对密钥进行更新



## 模运算

### 求最大公因子

![1603075799260](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1603075799260.png)



## Diffie-Hellman协议

使得在不安全信道上能协商得到密钥，并不会泄露给他人

# 侧信道了解

## 什么是侧信道

根据百度百科解释是，该技术比传统的密码分析更加有效快速，通过对加密电子设备的运行时间和功率消耗等侧信道信息来对设备进行攻击，以获取密码。（**也称为被动型非入侵式攻击**）



侧信道具体是指：密码实现运行过程中的能力消耗、电磁辐射、运行时间等信息



攻击类型：计时攻击、能力分析攻击和电磁攻击

## 现实作用

2013年12月，以色列特拉维夫大学的计算机安全专家Daniel Genkin 和Eran Tromer等公布了使用三星Note2手机从30厘米远的地方（手机麦克风对准风扇出风口）“听译”出计算机中的PGP程序密钥的方法



2014年8月，以色列特拉维夫大学的计算机安全专家Eran 
Tromer等公布了一种通过用手触碰笔记本电脑的外壳就能得到这台计算机上存储数据的安全密钥的方法，该团队测试了广泛使用的高安全标准的解密算法，并成功恢复了4096位RSA密钥和3072位ElGamal密钥。



2015年8月，来自上海交通大学的Yu Yu教授展示了通过侧信道攻击方法（能量分析攻击）攻击并克隆3G/4G手机卡的攻击方法。该研究团队成功分析了八个从各种运营商和制造商获得的3G/4G(UMTS / LTE) SIM卡。



2016年10月，来自以色列特拉维夫大学（Tel Aviv 
University）研究团队采用电磁攻击分析了苹果iOS系统中多种常用密码库的安全性，发现了多个可被侧信道攻击方法利用的实现弱点，并成功恢复了OpenSSL、CommonCrypto库中ECDSA实现的密钥。



## 如何防御

减弱或消除侧信道信息与密码之间的关联性，分别可以从软件和硬件层面解决

常见防御对策可以分为掩码对策和隐藏对策



# 侧信道知识

## 能量分析攻击

基本思想通过分析密码设备的能量消耗获取密钥，它基于了一个事实：**密码设备瞬时能量消耗依赖于设备所处理数据和设备所执行的操作**



### 如何防御

![1602401244915](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1602401244915.png)



**隐藏对策**

基本思想消除能量消耗的数据依赖度

1. 使得每一个操作都消耗相同能量制造设备

2. 采用能量消耗随机的设备

   

**掩码对策**

随机化密码设备所处理的中间值



## 密码设备

![1602401760716](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1602401760716.png)





## 能量消耗

### 能量仿真和消耗模型

1、汉明距离模型：用于对寄存器和总线进行仿真（当能连续获知数据的情况下）

2、汉明重量模型：无法使用汉明距离就使用汉明重量





## 能量测量

![1603678503804](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1603678503804.png)





## 功耗泄漏分析

SPA(简单功耗分析)：本质上是通过功耗轨迹进行猜测密钥

DPA(差分功耗分析)：密钥和明文加密后的汉明权重通过F函数进行分组，功耗轨迹通过对应的汉明权重进入各自分组，计算分组差值，差值比较大的一般为正确密钥

CPA（相关功耗分析）：通过旁路信号与中间结果的汉明权重的线性相关性，使用了Pearson相关系数法

![1603713576496](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\1603713576496.png)



模板分析方法：通过对旁路泄漏轨迹中随机变量统计分析特性进行建模，用判别分析的方法获取旁路泄漏轨迹中隐藏的秘密信息

